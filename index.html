<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Civil Freelance Jobs</title>

<style>
* { box-sizing: border-box; font-family: system-ui; }
body { background:#fafafa; padding:0; margin:0; }

nav {
  background:#fff;
  padding:12px 16px;
  border-bottom:1px solid #ddd;
  display:flex;
  justify-content:space-between;
}

nav ul { list-style:none; display:flex; gap:12px; }

.container { max-width:700px; margin:20px auto; padding:16px; }

.job {
  background:#fff;
  padding:16px;
  border:1px solid #ddd;
  border-radius:6px;
  margin-bottom:12px;
}

.page { display:none; }
.page.active { display:block; }

.success { color:green; margin-top:10px; }

button { padding:8px 14px; cursor:pointer; }
</style>
</head>

<body>

<nav>
  <h3>Civil Freelance Jobs</h3>
  <ul>
    <li><a href="#" onclick="showPage('home')">Home</a></li>
    <li><a href="#" onclick="showPage('post')">Post Job</a></li>
  </ul>
</nav>

<div class="container">

<!-- HOME -->
<div id="home" class="page active">
  <div id="jobs"></div>
</div>

<!-- POST -->
<div id="post" class="page">
  <h2>Post Job</h2>

  <form id="jobForm">
    <input required placeholder="Job Title"><br><br>
    <textarea required placeholder="Description"></textarea><br><br>
    <input type="email" required placeholder="Email"><br><br>
    <button type="submit">Submit</button>
  </form>

  <div id="successMessage" class="success" style="display:none"></div>
</div>

</div>

<script>
function showPage(id) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

document.getElementById("jobForm").addEventListener("submit", submitJob);

async function submitJob(e) {
  e.preventDefault();

  const [title, description, email] = e.target.elements;

  try {
    const res = await fetch("/api/post-job", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        title: title.value,
        description: description.value,
        email: email.value
      })
    });

    if (!res.ok) throw new Error("Request failed");

    const msg = document.getElementById("successMessage");
    msg.innerText = "Verification email sent. Check spam too.";
    msg.style.display = "block";
    e.target.reset();

  } catch (err) {
    alert("Submission failed. Check console.");
    console.error(err);
  }
}

async function loadJobs() {
  const res = await fetch("/api/get-jobs");
  const jobs = await res.json();

  const container = document.getElementById("jobs");
  container.innerHTML = "";

  jobs.forEach(j => {
    container.innerHTML += `
      <div class="job">
        <b>${j.title}</b>
        <p>${j.description}</p>
        <i>${j.email}</i>
      </div>`;
  });
}

loadJobs();
</script>

</body>
</html>
